var a1_0x7bdc=['genarateKeys','getKeyExchangeCertificate','acceptKeyExchangeCertificate','cert','verify','removeOldCertificate','length','crypto','../AddressCalculator/Secp160k1.js','aes-256-gcm','setSecurityLevel','_certificateBank','from','randomBytes','createCipheriv','toString','hex','final','getAuthTag','base64','stringify','utf8','parse','setAuthTag','tag','update','Cannot\x20be\x20Null\x20!','createHash','sha256','digest','encryptDataPublicKey','computeSecret','_160k1','certWorker','decryptDataPublicKey','Invalid\x20public\x20Key','sign','data','encryptFilePublicKey','decryptFilePublicKey','setPrivateKey'];(function(_0x52faae,_0x5d541a){var _0x2d2bfb=function(_0x4c3732){while(--_0x4c3732){_0x52faae['push'](_0x52faae['shift']());}};_0x2d2bfb(++_0x5d541a);}(a1_0x7bdc,0x126));var a1_0x28bd=function(_0x2748b3,_0x5ac604){_0x2748b3=_0x2748b3-0x0;var _0x12ba52=a1_0x7bdc[_0x2748b3];return _0x12ba52;};const modCrypto=require(a1_0x28bd('0x0'));const modSecp160k1=require(a1_0x28bd('0x1'));const certificateWorker=require('../AddressCalculator/CertificateWorker.js');var _Method=Encryptor['prototype'];const cIV_LENGTH=0x10;const cAUTH_TAG_LENGTH=0x20;const cErrorLevel_1=0x1;const cErrorLevel_2=0x2;const cErrorLevel_3=0x3;const cAlgorithm=a1_0x28bd('0x2');function Encryptor(_0x227c63,_0x39f43a){this['_160k1']=new modSecp160k1(_checkForNull(_0x227c63));_Method[a1_0x28bd('0x3')](_0x39f43a);this[a1_0x28bd('0x4')]={'digitalAddress':undefined,'certificate':undefined};}function _Encrypt(_0x58e4e2,_0x129310){var _0x348e65=new Buffer[(a1_0x28bd('0x5'))](_0x58e4e2);let _0x1f4800=modCrypto[a1_0x28bd('0x6')](cIV_LENGTH);var _0x1cac62=modCrypto[a1_0x28bd('0x7')](cAlgorithm,_0x129310,_0x1f4800);var _0x28f87c=_0x1cac62['update'](_0x348e65[a1_0x28bd('0x8')]('hex'),a1_0x28bd('0x9'),a1_0x28bd('0x9'));_0x28f87c+=_0x1cac62[a1_0x28bd('0xa')](a1_0x28bd('0x9'));var _0x35a07b=_0x1cac62[a1_0x28bd('0xb')]();var _0x15dd0f={'iv':_0x1f4800[a1_0x28bd('0x8')](a1_0x28bd('0xc')),'content':Buffer[a1_0x28bd('0x5')](_0x28f87c,a1_0x28bd('0x9'))[a1_0x28bd('0x8')](a1_0x28bd('0xc')),'tag':_0x35a07b[a1_0x28bd('0x8')]('base64')};return Buffer[a1_0x28bd('0x5')](JSON[a1_0x28bd('0xd')](_0x15dd0f),a1_0x28bd('0xe'))[a1_0x28bd('0x8')](a1_0x28bd('0xc'));}function _Decrypt(_0x5cd485,_0x106a01){var _0x4586c2=JSON[a1_0x28bd('0xf')](Buffer[a1_0x28bd('0x5')](_0x5cd485,a1_0x28bd('0xc'))[a1_0x28bd('0x8')](a1_0x28bd('0xe')));var _0xa3612a=modCrypto['createDecipheriv'](cAlgorithm,_0x106a01,Buffer[a1_0x28bd('0x5')](_0x4586c2['iv'],a1_0x28bd('0xc')));_0xa3612a[a1_0x28bd('0x10')](Buffer[a1_0x28bd('0x5')](_0x4586c2[a1_0x28bd('0x11')],a1_0x28bd('0xc')));var _0x393beb=_0xa3612a[a1_0x28bd('0x12')](_0x4586c2['content'],'base64',a1_0x28bd('0xe'));_0x393beb+=_0xa3612a['final']('utf8');return _0x393beb;}function _checkForNull(_0x5527d8){if(_0x5527d8===null){throw a1_0x28bd('0x13');}return _0x5527d8;}function _SHA256(_0x2b924f){var _0x214778=modCrypto[a1_0x28bd('0x14')](a1_0x28bd('0x15'))[a1_0x28bd('0x12')](_0x2b924f)[a1_0x28bd('0x16')]();return _0x214778;}_Method[a1_0x28bd('0x17')]=function(_0x27b695,_0x5e5bc3){if(this[a1_0x28bd('0x4')][_0x5e5bc3]!==undefined){certificate=this[a1_0x28bd('0x4')][_0x5e5bc3];}else{return'Invalid\x20public\x20Key';}var _0xe1ef20=this['certWorker'][a1_0x28bd('0x18')](certificate);var _0x234bdd=this[a1_0x28bd('0x19')]['sign'](_0x27b695);var _0x59a905={'data':_0x27b695,'sign':_0x234bdd};var _0x28f639=this[a1_0x28bd('0x1a')]['sign'](JSON[a1_0x28bd('0xd')](_0x59a905));return _Encrypt(JSON['stringify']({'data':_0x59a905,'sign':_0x28f639}),_SHA256(_0xe1ef20),null,null);};_Method[a1_0x28bd('0x1b')]=function(_0x4b59e5,_0x97050a){var _0x48f24f=undefined;if(this[a1_0x28bd('0x4')][_0x97050a]!==undefined){certificate=this['_certificateBank'][_0x97050a];}else{return a1_0x28bd('0x1c');}var _0x544735=this[a1_0x28bd('0x1a')][a1_0x28bd('0x18')](certificate);var _0x2c058d=JSON['parse'](_Decrypt(_0x4b59e5,_SHA256(_0x544735),null,null));if(![]!==this['certWorker']['verify'](JSON[a1_0x28bd('0xd')](_0x2c058d['data']),_0x2c058d[a1_0x28bd('0x1d')],certificate)){if(![]!==this['_160k1']['verify'](_0x2c058d[a1_0x28bd('0x1e')][a1_0x28bd('0x1e')],_0x2c058d[a1_0x28bd('0x1e')][a1_0x28bd('0x1d')],_0x97050a)){_0x48f24f=_0x2c058d[a1_0x28bd('0x1e')][a1_0x28bd('0x1e')];}else{return cErrorLevel_2;}}else{return cErrorLevel_1;}return _0x48f24f;};_Method[a1_0x28bd('0x1f')]=function(_0x6f93c7,_0x553e03){var _0x37ca42=this[a1_0x28bd('0x19')]['computeSecret'](_0x553e03);return _Encrypt(_0x6f93c7,_SHA256(_0x37ca42),null,null);};_Method[a1_0x28bd('0x20')]=function(_0x23f7f6,_0x18a905){var _0x4f2ed2=this[a1_0x28bd('0x19')][a1_0x28bd('0x18')](_0x18a905);return _Decrypt(_0x23f7f6,_SHA256(_0x4f2ed2),null,null);};_Method[a1_0x28bd('0x21')]=function(_0x31ceba){this[a1_0x28bd('0x19')]=new modSecp160k1(_0x31ceba);};_Method['setSecurityLevel']=function(_0x3f1cb3){this[a1_0x28bd('0x1a')]=new certificateWorker(_0x3f1cb3);this['certWorker'][a1_0x28bd('0x22')]();};_Method[a1_0x28bd('0x23')]=function(_0x188af2){var _0x974b9b=this[a1_0x28bd('0x19')]['computeSecret'](_0x188af2);var _0x497a71=this[a1_0x28bd('0x1a')]['getCertificate']();var _0x531c55=this[a1_0x28bd('0x19')][a1_0x28bd('0x1d')](_0x497a71);var _0x15ec8a={'cert':_0x497a71,'sign':_0x531c55};var _0x1388b1=this[a1_0x28bd('0x1a')][a1_0x28bd('0x1d')](JSON['stringify'](_0x15ec8a));var _0x6e5bab={'cert':_0x15ec8a,'sign':_0x1388b1};var _0x6a02ad=this[a1_0x28bd('0x19')][a1_0x28bd('0x1d')](_0x6e5bab);return _Encrypt(JSON[a1_0x28bd('0xd')]({'cert':_0x6e5bab,'sign':_0x6a02ad}),_SHA256(_0x974b9b),null,null);};_Method[a1_0x28bd('0x24')]=function(_0xf1680e,_0x5c980b){var _0x1d06b6=this[a1_0x28bd('0x19')][a1_0x28bd('0x18')](_0x5c980b);var _0x1f196d=JSON['parse'](_Decrypt(_0xf1680e,_SHA256(_0x1d06b6),null,null));if(![]!==this[a1_0x28bd('0x19')]['verify'](_0x1f196d[a1_0x28bd('0x25')],_0x1f196d[a1_0x28bd('0x1d')],_0x5c980b)){if(![]!==this[a1_0x28bd('0x1a')][a1_0x28bd('0x26')](JSON[a1_0x28bd('0xd')](_0x1f196d[a1_0x28bd('0x25')][a1_0x28bd('0x25')]),_0x1f196d[a1_0x28bd('0x25')][a1_0x28bd('0x1d')],_0x1f196d[a1_0x28bd('0x25')]['cert']['cert'])){if(![]!==this['_160k1']['verify'](_0x1f196d['cert'][a1_0x28bd('0x25')][a1_0x28bd('0x25')],_0x1f196d[a1_0x28bd('0x25')]['cert']['sign'],_0x5c980b)){this[a1_0x28bd('0x4')][_0x5c980b]=_0x1f196d[a1_0x28bd('0x25')][a1_0x28bd('0x25')]['cert'];}else{return cErrorLevel_3;}}else{return cErrorLevel_2;}}else{return cErrorLevel_1;}return this[a1_0x28bd('0x4')][_0x5c980b];};_Method[a1_0x28bd('0x27')]=function(_0x5059ad){try{delete this['_certificateBank'][_0x5059ad[a1_0x28bd('0x8')]('utf8')];}catch(_0x1e22e5){}};_Method['IsBankEmpty']=function(){return Object['keys'](this[a1_0x28bd('0x4')])[a1_0x28bd('0x28')]===0x2;};module['exports']=Encryptor;